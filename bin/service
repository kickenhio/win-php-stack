#!/bin/bash
SERVICE="$1"
COMMAND="$2"
PHPEXEC=$(php.exe -i | grep php.exe | head --lines 1)
PHPEXEC=${PHPEXEC#*>}
PHPDIR=${PHPEXEC%\/php.exe*}
PHPDIR=$(echo $PHPDIR | tr -d '\r')
NGINXPATH="$(dirname "$0")"
NGINXPATH=${NGINXPATH%\/bin*}


function processing() {
    COUNT=$(tasklist | findstr "$1" | wc -l)
    echo $COUNT
}


if [ $SERVICE ] && [ $SERVICE == 'nginx' ]; then
    if [ $COMMAND ] && [ $COMMAND == 'start' ]; then
        cd "$NGINXPATH"
        PS=$(processing nginx)
        if [ $PS == "0" ]; then
            start nginx
            echo 'Nginx is warming up...'
        else
            echo 'Nginx is already running'
        fi
    elif [ $COMMAND ]; then
        cd "$NGINXPATH"
        PS=$(processing nginx)
        if [ $PS == "0" ]; then
            echo "Nginx service is not running!"
        else
            ./nginx.exe -s $COMMAND
            echo "Processing $COMMAND for nginx service..."
        fi
    else
        echo 'No command provided'
    fi
else
    echo 'No such a service'
fi